# OX语言环境运行说明
## 符号说明
注意以下文档中使用了一些特定符号，其定义如下：

* %INSTALL_DIR%: 用户安装OX语言环境的目录。
* %TARGET%: OX环境安装的目标系统架构名称。此名称格式为"arch-vendor-os-abi"。比如x86 64位平台的linux下“%TARGET%”为“x86_64-pc-linux-gnu”。x86 32位平台linux下“%TARGET%”为“i686-pc-linux-gnu”。64位Windows平台下“%TARGET%”为“x86_64-w64-windows-gnu”。

## 目录结构
OX环境的目录结构类似unix系统。在OX语言环境安装目录下，有以下子目录：

|目录|说明|
|:-|:-|
|bin|存放可执行程序,Windows系统下dll库也放在此目录下。|
|lib|存放动态链接库和静态链接库。|
|etc|存放配置文件。|
|include|存放头文件。|
|share/ox/pkg|存放安装的OX软件包。其中“all”目录下存放适用于全部架构的软件包，“%TARGET%”目录下存放特定系统架构的软件包。|
|share/ox/doc|存放OX语言相关文档。|

## 执行程序
OX语言环境启动程序在Linux系统下为“%INSTALL_DIR%/bin/ox”，在Windows系统下为"%INSTALL_DIR%/bin/ox.exe"。
可以将目录"%INSTALL_DIR%/bin"加入环境变量"PATH"，这样可以直接输入"ox"运行启动程序。

运行下面的命令查看OX语言的版本信息:
```
ox --version
```
## 运行脚本
可执行程序带入需要执行的脚本文件的路径将执行这个脚本。如要运行脚本程序文件"my_dir/my_program.ox"，执行以下命令：
```
ox my_dir/my_program.ox
```
如果执行脚本需要传入选项，可以在脚本路径后带入。比如下面的命令：
```
ox test.ox myarg1 myarg2 myarg3
```
命令将执行脚本"test.ox", 脚本将收到4个字符串的选项，“test.ox“, ”myarg1", "myarg2", "myarg3”。

OX执行程序本身也可以带入选项，脚本文件路径前的是OX执行程序的选项，脚本文件路径后的是脚本本身的选项。如下命令：
```
ox --log --log-file mylog.log test.ox myarg1 myarg2 myarg3
```
命令运行脚本"test.ox"，“ox --log --log-file mylog.log” 这部分为OX执行程序的选项，"test.ox myarg1 myarg2 myarg3" 这部分为脚本"test.ox"的选项。

有时用户希望直接在命令行输入脚本，可使用"-s"选项直接在参数中编写脚本。比如执行以下命令：
```
ox -s "ref \"std/io\"; stdout.puts(\"hello!\")"
```
终端显示：
```
hello
```
有时用户希望运行一段脚本并直接显示脚本的返回值，可使用选项"--pr"打印脚本的返回值，如执行以下命令:
```
ox --pr -s "1234+4321"
```
终端显示：
```
5555
```
有时用户希望执行一个已安装软件包中的程序，而不是指定脚本文件路径。可使用选项"-r"，如执行以下命令:
```
ox -r http/server
```
此时"http/server"代表"软件包名/脚本名"，而不是脚本文件路径。这段命令代表运行已安装软件包“http"中的脚本"server"。
注意脚本名中不要带".ox"后缀。执行程序会自动查找已安装的软件包和包中的脚本。

## 语言设置
OX通过gettext支持多语言。用户可以通过设置环境变量"LANG"切换OX的输出语言。Linux下，设置当前语言为中文：
```
export LANG=zh_CN.UTF-8
```
Linux下，设置当前语言为英文：
```
export LANG=en_US.UTF-8
```
Windows下，设置当前语言为中文：
```
set LANG=zh_CN.UTF-8
```
Windows下，设置当前语言为英文：
```
set LANG=en_US.UTF-8
```

## 日志
OX脚本运行时，可以通过日志系统打印信息，方便用户调试。

通过选项"--log"可以指定日志信息的打印等级。

|参数|说明|
|:-|:-|
|a|输出全部日志信息|
|d|输出等级大于等于调试级的日志信息|
|i|输出等级大于等于一般信息级的日志信息|
|w|输出等级大于等于警告级的日志信息|
|e|输出等级大于等于错误级的日志信息|
|f|输出等级大于等于致命错误级的日志信息|
|n|关闭日志打印|

日志信息是以"|"分隔的多个信息域，比如下面为"test.ox"的日志信息：
```
I|2025-11-24 15:59:48.843|1483079|test|"test.ox"|test_func|42|test start
E|2025-11-24 15:59:48.843|1483079|test|"test.ox"|test_func|56|test failed
```
如果用户不希望打印某些域的信息，可以通过选项"--log-field"的参数进行指定。"--log-field"的参数为一个字符串，其中每一个字符代表打开一个信息域：

|参数|说明|
|:-|:-|
|l|日志等级。<br>D: 调试信息<br>I: 普通信息<br>W: 警告信息<br>E: 错误信息<br>F: 致命错误信息<br>|
|d|日期，输出格式为 年年年年-月月-日日|
|t|时间，输出格式为 时时:分分:秒秒|
|m|毫秒|
|T|日志信息标签|
|f|文件名|
|F|函数名|
|L|行号|
|i|线程ID|

默认情况下日志信息会打印到标准错误输出，如果用户想将日志打印到某个文件，可使用"--log-file"选项：
```
ox --log a --log-file mylog.txt test.ox
```
命令运行脚本"test.ox"并将日志输出到文件"mylog.txt"中。

## 用法和选项
查看可执行程序的用法和选项，执行以下命令:
```
ox --help
```
可执行程序的常用参数如下:

|选项|参数|说明|
|:-|:-|:-|
|--ast||输出JSON格式的脚本抽象语法树。|
|--bc||输出脚本对应的字节码值令。|
|-c||只编译脚本，不运行程序。|
|-d|DIR|增加一个软件包查找目录。如果没有指定-d选项，OX查找“%INSTALL_DIR%/share/ox/all”和“%INSTALL_DIR%/share/ox/%TARGET%”两个目录。如果指定了"-d"选项，OX在"-d"选项指定的目录中寻找软件包。此参数可以多次使用。|
|--dump-throw||抛出错误时打印堆栈信息。缺省状态下OX只有当抛出的错误没有被程序捕获时才会打印错误产生时的堆栈信息。指定此选项，OX在程序抛出错误时立即打印堆栈信息，这样可以帮助开发者快速定位错误产生的位置。|
|--enc|ENCODING|设置输入脚本文件的字符编码。缺省状态下OX默认的字符编码为"UTF-8"。|
|--help||显示帮助信息。|
|--log|a\|d\|i\|w\|e\|f\|n|设置日志输出等级。|
|--log-field|FIELD|设置日志输出的信息域。|
|--log-file|FILE|设置日志输出文件名。|
|-p||只解析文件为抽象语法树，不进行编译。|
|--pr||打印程序运行结果。|
|-r||加载包管理器管理的一个可执行程序。|
|-s|SOURCE|运行脚本字符串SOURCE。|
|--version||显示OX版本号。|


